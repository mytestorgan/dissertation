\chapter{СИНТЕЗ МЕТОДА КОМПЕНСАЦИИ ДЖИТТЕРА ДЛЯ ПОТОКОВОГО ТРАФИКА В ГИБРИДНЫХ СЕТЯХ } \label{chapt:estim}

\section{Обзор методов оценки джиттера} \label{sect_analis_filters}
\subsection{Обзор метода оценки джиттера в стационарном состоянии}

В стационарном состоянии сети задержка $x(t)$ представляет собой случайную величину, распределение вероятностей которой близкое к нормальному $N(0,\xi_x)$ \cite{clark}. 
Однако реальная статистика сети не является стационарной, как мы видим из второго раздела. 
Таким образом, возникают флуктуации задержки, которые могут иметь как разовый характер, так и продолжаться длительное время.
Все это приводит к тому, что плотность задержки $p(x)$ нельзя считать идеально распределенной. 
Более того из-за значительного уровня априорной неопределенности, реальную статистику, как правило, не удается параметризировать. 
Поэтому традиционные, хорошо разработанные параметрические процедуры, которые будут рассмотрены далее, для построения алгоритмов оценки задержки применить сложно и рискованно. 
В этом случае имеет смысл перейти к непараметрическим робастным алгоритмам, которые хоть и не являются оптимальными, однако отличаются устойчивостью и при прочих равных условиях не проигрывают параметрическим \cite{tihonov}.

Интерес к робастной обработке возник из осознания того факта, что исследователь никогда не располагает полными знаниями о действительной статистике.
Кроме того, предположение о гауссовом характере мешающих воздействий слишком идеализировано.
Как правило, мешающие воздействия имеют небольшой процент аномальных ``выбросов'', что приводит к утяжелению хвостов распределения. 
Эта статистическая неопределенность, а также наличие аномалий может быть учтена в модели ``засоренного'' распределения, предложенного Хьюбером \cite{huber}.

\begin{equation}\label{eq3:huber}
P(x)=(1-\varepsilon)P_0(x)+\varepsilon P_1(x),
\end{equation}
\noindent где $\varepsilon$ - небольшое положительное действительное число $(\varepsilon<0,1)$, $F_0(x)$ - известное распределение, $P_1(x)$ - распределение, принадлежащее некоторому классу, симметричное с конечной дисперсией.

Далее при построении алгоритма за основу взят принцип минимакса, т.е. алгоритм строится в расчете на наименее благоприятное распределение.

Используем такой подход к построению алгоритма оценки процесса джиттера $S(\varphi)$. 
В качестве модели помех используем модель ``засоренного'' нормального распределения

\begin{equation}\label{eq3:kustov}
W(k)=(1-\varepsilon)N(0,\sigma)+\varepsilon N_1(0,\sigma_1),
\end{equation}

\noindent где $N(0,\sigma)$ и $N_1(0,\sigma_1)$ - нормальные распределения с нулевыми математическими ожиданиями и дисперсиями $\sigma$ и $\sigma_1$. 
Такая модель является наиболее характерной: составляющая $N_1$ описывает аномальную долю помех; составляющая $N$ прочие помехи, имеющие вид гауссовых.

Тогда плотность совместного распределения аддитивной смеси процесса и шума будет иметь вид:
\begin{equation}\label{eq3:kustov1}
W(V)=\frac{1-\varepsilon}{\sigma \sqrt{2\pi}}exp\frac{(V-S)^2}{2\sigma^2}+\varepsilon\frac{1}{\sigma_1\sqrt{2\pi}}exp\frac{(V-S)^2}{2\sigma_1^2},
\end{equation}

\noindent где $V=S(t)+n(t)$ - наблюдение процесса $S(\varphi)$, соответствующее уравнению наблюдения (\ref{eq3:Estim}).

Если наблюдение производится в дискретные моменты времени, то функция правдоподобия фазы джиттера $\varphi$ может быть записана в виде:

\begin{equation}\label{eq3:kustov2}
\begin{split}
L(\varphi)=&\prod_{i=1}^M \{(1-\varepsilon)\frac{1}{\sigma\sqrt{2\pi}}exp-\frac{[V_i-S_i(\varphi)]^2}{2\sigma^2}+\\
&+\varepsilon\frac{1}{\sigma_1\sqrt{2\pi}}exp-\frac{[V_i-S_i(\varphi)]^2}{2\sigma_1^2} \}.
\end{split}
\end{equation}

Для определения алгоритма оценки воспользуемся методом максимума функции правдоподобия \cite{tihonov}, т.е. в качестве оценки примем значение фазы $\hat{\varphi}$, являющейся решением уравнения:
\begin{equation}\label{eq3:kustov3}
\frac{dL}{d\varphi}/_{\varphi=\hat{\varphi}}=0.
\end{equation}

Подставим в уравнение (\ref{eq3:kustov3}) значение функции правдоподобия (\ref{eq3:kustov2}), получим уравнение:

\begin{equation}\label{eq3:kustov4}
\begin{split}
&\sum_{i=1}^M\left[\frac{V_i-S_i(\varphi)}{\sigma^2}\right]\frac{dS(\varphi)}{d\varphi}-\\
&-\sum_{i=1}^M\frac{\frac{\varepsilon}{1-\varepsilon}\frac{\sigma_1^2-\sigma^2}{\sigma_1^3\sigma}[V_i-S_i(\varphi)]\frac{dS_i(\varphi)}{d\varphi}exp\left\{\frac{\sigma_1^2-\sigma^2}{2\sigma_1^2\sigma^2}[V_i-S_i(\varphi)]\right\}}{1+\frac{\varepsilon}{1-\varepsilon}exp\left\{\frac{\sigma_1^2-\sigma^2}{2\sigma_1^2\sigma^2}[V_i-S_i(\varepsilon)]^2\right\}}=0.
\end{split}
\end{equation}

В \cite{kustova} используются следующие значения величин: $\varepsilon\leq0,1$ и $\sigma_1\geq10\sigma$.

Рассмотрим вторую сумму сначала уравнения. Если $V_i\geq3\sigma_1$, то единицей в знаменателе можно пренебречь и тогда этот член в сумме имеет вид:
\begin{equation}\label{eq3:kustov5}
\frac{1}{\sigma^2}[V_i-S_i(\varphi)]\frac{dS(\varphi)}{d\varphi},
\end{equation}
\noindent т.е. равен соответствующему члену первой суммы, а их разность равна 0, т.е. в оптимальном алгоритме при обработке эти члены не учитываются.

Если $V_i\leq3\sigma$, то вторым членом в знаменателе второй суммы можно пренебречь по сравнению с единицей. Числитель второй суммы будет иметь значение $\leq0,01$ и этими составляющими первой суммы можно пренебречь.

Данный алгоритм следует использовать, когда ситуация сугубо стационарна, а сам джиттер будет представлять собой случайную величину.
В нестационарных условиях необходимо переходить к рекурсивным процедурам, позволяющим находить решения с случае, когда джиттер представляет собой случайный процесс с выбросами и скачками.

\subsection{Рекурсивные методы оценки джиттера}

Рассмотренная процедура оценки джиттера (\ref{eq3:kustov3}), (\ref{eq3:kustov4}) является точечной, привязанной к конкретной ситуации. В этой процедуре, не учитывается предыстория и не используется экстраполяция, что для решений сетевых задач имеет принципиальное значение. 
Очевидно, можно создать процедуру, состоящую из последовательности точечных оценок в каждой из временных позиций по алгоритму (\ref{eq3:kustov4}).
Но данная процедура не ориентирована на учет корреляционных связей между соседними позициями $i$ и $i+1$.

Применим более общую марковскую модель, при которой соседние позиции связаны соотношением:
\begin{equation}\label{eq3:kustov6}
x(i+1)=P(x_{i+1}/x_i)x(i),
\end{equation}
\noindent где $P(x_{i+1}/x_i)$ - вероятность перехода, представляющая по сути коэффициент корреляции между указанными позициями процесса $x(i)$.

Выбор модели (\ref{eq3:kustov6}) позволяет построить рекурсивную процедуру, как самой модели состояния процесса $x(i)$, 
так и алгоритма оценки в виде фильтра Калмана-Бьюси или в виде более простой процедуры стохастической аппроксимации \cite{tihonov}.










Фильтр Калмана-Бьюси дает решение задачи оптимального оценивания в линейных динамических системах при гауссовском распределение процессов и помех.
Однако в прикладной задаче диссертации, распределение шумов не является гауссовским, причем распространенной причиной отклонения распределения вероятностей помех от гауссовского является наличие выбросов и скачков в оцениваемом процессе.
Хорошо известно \cite{cipkin}, что такие отклонения существенно ухудшают качество оценок, получаемых с помощью алгоритмов, оптимальных для гауссовских помех.
Поэтому не случайно большое внимание уделяется разработке робастных алгоритмов фильтрации, стабильно работающих в условиях, когда помехи содержат выбросы или скачки \cite{Klekis, masreliez_ieee, masreliez_martin, ershov_lipcer, ershov, RobustFilter}.
В \cite{masreliez_ieee} задача фильтрации при наличии выбросов решалась, как задача   негауссовской фильтрации, однако реализация полученного алгоритма на ЭВМ представляет значительные трудности. 
Дальнейшее развитие этот подход получил в \cite{masreliez_martin}. Однако этот алгоритм фильтрации имеет ряд недостатков: для его построения необходимо знать вероятность появления выброса и распределение вероятностей помех должно быть симметричным. Данный подход не подходит для решения нашей задачи, так как задержка в телекоммуникационных системах является нестационарной.

Другой подход к решению задачи фильтрации помех, содержащих выбросы, представлен в \cite{ershov_lipcer, ershov}. В представлении шумов предполагается, что с большей вероятностью помехи измерения распределены нормально с нулевым средним и заданной ковариационной матрицей и с малой вероятностью распределены также нормально,  но с ковариационной матрицей, имеющей большую норму. Алгоритм фильтрации основан на обнаружении момента появления выброса и изменении коэффициента усиления в зависимости от результатов обнаружения. Для модификации коэффициента используется ковариационная матрица источников выбросов.

В \cite{Klekis} предполагается, что в штатном режиме работы измерительного устройства помехи распределены нормально с нулевым средним и известной ковариационной матрицей, а в режиме сбоев помехи имеют нормальное распределение с неизвестным средним и той же ковариационной матрицей.
Алгоритм фильтрации получен на основе обнаружения момента появления выброса, оценивания его амплитуду и соответственно модифицируя коэффициент усиления и ковариационную матрицу. В этом случае априорной информации о характеристиках выбросов не требуется.  

Рассмотрим более детально рекурсивные алгоритмы фильтрации.


\subsection{Фильтр Калмана-Бьюси (ФКБ)}\label{FKB}
\nomenclature{ФКБ}{Фильтр Калмана-Бьюси}
 ФКБ синтезирован с учетом того, что наблюдаемый процесс соответствует уравнению (\ref{eq3:modelStat}) и наблюдается на фоне гауссовского белого шума.
 Уравнение оценки в виде условного среднего значения задержки с использованием ФКБ имеет вид:


\begin{equation}\label{eq3:Estim_rel}
\hat{x}(k+1)=\Phi\hat{x}(k)+K(k)\Delta y,
\end{equation}
\noindent где $\Delta y=H\Phi\hat{x}(k)-y(k)$ - невязка, $K(k)$ - коэффициент, обеспечивающий устойчивость и сходимость процедуры, в частности $K(k)$ может быть константой $K\leq1$. 
Коэффициент усиления ФКБ $K(k)$ является функцией от апостериорной дисперсии ошибки оценки $V(k)$, что ускоряет его сходимость:

\begin{equation}\label{eq3:K}
K(k)=V(k)H^TN_{\nu}^{-1},
\end{equation}
 
\begin{equation}\label{eq3:V}
V(k)=[I-K(k-1)H(k)]V(k,k-1),
\end{equation}


\begin{equation}\label{eq3:Vkk-1}
V(k,k-1)=\Phi^TV(k-1)\Phi+N_\xi,
\end{equation}

\noindent где $V(k)$ - апостериорная дисперсия ошибки оценки, $V(k,k-1)$ - априорная дисперсия ошибки оценки, $I$ - единичная матрица.

На рис. \ref{img3:kalmanF} представлена схема фильтра оценки, построенная в соответствии с (\ref{eq3:Estim_rel}). Ключевую роль в оценке ФКБ текущего значения задержки, играет параметр $\Phi$, позволяющий регулировать сглаживающие свойства фильтра. 

\begin{figure} [h]
  \center
\includegraphics[width=0.8\textwidth]{3chapter/output2.eps}
  \caption{Схема ФКБ}
  \label{img3:kalmanF}
\end{figure}

\section{Синтез алгоритма ФКБ в различных условиях априорной неопределенности}
Как следует из \ref{FKB} для классического алгоритма ФКБ необходимы априорные данные о значениях спектральной плотности шума модели $N_\xi$ шума наблюдения $N_\nu$, а также значения интервалов корреляции,  определяемой матрицей $\Phi$. В реальных условиях эти априорные данные могут отсутствовать, а вместо них могут быть известны другие данные статистики связанные с указанными выше.
Рассмотрим ряд таких алгоритмов, отличающихся различным уровнем априорной неопределенности.
\subsection{ Алгоритм фильтрации для извесной последовательности мест выбросов и дисперсии процесса выбросов}
Выражения, описывающие алгоритм, имеют вид:

\begin{equation}\label{eq3:optim2}
\hat{x}(k+1)=\Phi\hat{x}(k)+K(k)\Delta y,
\end{equation}

\begin{equation}\label{eq3:optim2_3}
V(k|k-1)=\Phi(k-1)V(k-1)\Phi^T(k-1)+N_\xi,
\end{equation}

\begin{equation}\label{eq3:optim2_4}
\begin{split}
K(k)=&V(k|k-1)H^T(k)\{H(k)V(k|k-1)H^T(k)+\\
&+[1-r_v(k)]R_1(k)+r_v(k)R_2(k)\}^{-1},
\end{split}
\end{equation}

\begin{equation}\label{eq3:optim2_5}
V(k)=[I-K(k-1)H(k)]V(k,k-1).
\end{equation}

\subsection{ Алгоритм фильтрации для известной вероятности появления выбросов и известной дисперсии процесса выбросов} 
Выражения, описывающие алгоритм, имеют вид:

\begin{equation}\label{eq3:optim3}
\hat{x}(k+1)=\Phi\hat{x}(k)+K(k)\Delta y,
\end{equation}

\begin{equation}\label{eq3:optim3_3}
V(k|k-1)=\Phi(k-1)V(k-1)\Phi^T(k-1)+N_\xi,
\end{equation}

\begin{equation}\label{eq3:optim3_4}
\begin{split}
K(k)=&V(k|k-1)H^T(k)[H(k)V(k|k-1)H^T(k)+\\
&+(1-\varepsilon)R_1(k)+\varepsilon R_2(k)]^{-1},
\end{split}
\end{equation}

\begin{equation}\label{eq3:optim3_5}
V(k)=[I-K(k-1)H(k)]V(k,k-1).
\end{equation}

\subsection{Алгоритм фильтрации, требующий информацию о характеристиках процесса выбросов} 
Выражения, описывающие алгоритм, имеют вид:

\begin{equation}\label{eq3:optim4}
\hat{x}(k+1)=\Phi\hat{x}(k)+K(k)\Delta y,
\end{equation}

\begin{equation}\label{eq3:optim4_3}
V(k|k-1)=\Phi(k-1)V(k-1)\Phi^T(k-1)+N_\xi,
\end{equation}

\begin{equation}\label{eq3:optim4_4}
\begin{split}
K(k)=&V(k|k-1)H^T(k)\{H(k)V(k|k-1)H^T(k)+\\
&+(1-\hat{r}_v(k))R_1(k)+\hat{r}_v(k)R_2(k)\}^{-1},
\end{split}
\end{equation}

\begin{equation}\label{eq3:optim4_5}
\begin{split}
V(k)=&[I-K(k-1)H(k)]V(k,k-1)[I-K(k-1)H(k)]^T+\\
&+K(k)R_1(k)K^T(k).
\end{split}
\end{equation}

\begin{equation}
\hat{r}_v(k)= \;
\begin{cases}
0, \; ||\Delta y(k)||\leq c_1 \\    
1, \; ||\Delta y(k)||> c_1    
\end{cases}
\end{equation}

Рассмотренные алгоритмы ориентированы на использование их в стационарных условиях. По анализу качества этих алгоритмов имеются обширные исследования\cite{Klekis,huber,tihonov}. 
В реальных нестационарных условиях качество их оценки резко снижается, как правило, пропорционально отклонению от выбранной математической модели.
На практике обычно поступают следующим образом, если отклонение от статистической модели незначительное, то ими пренебрегают и рассматривают квазистационарный вариант ФКБ. 
При более выраженных нестационарных отклонениях прибегают к адаптивным процедурам \cite{tihonov,popovski}
при этом предполагается известность статистики самих нестационарных воздействий.
Получаемая при этом оценка нестационарности подставляется в основной алгоритм, который далее рассматривается как стационарный.

Другим методом решения нестационарных явлений является метод кусочностационарных моделей, при этом переход на ту или иную модель управления осуществляется за счет обнаружения интервала корреляции квазистационарности \cite{tihonov}.

Более общим является выбор алгоритма фильтрации не требующего информации о вероятностях амплитудных выбросов нестационарности.
Рассмотрим его более подробно.

\subsection{Алгоритм фильтрации, не требующий информации о вероятности появления и амплитудах выбросов.} Алгоритм использует следующую модель помех:
\begin{equation}\label{eq3:optim5_01}
\nu_{re}(k)=\nu_{id}(k)+r_v(k)Bu(k),
\end{equation}
\begin{equation}\label{eq3:optim5_02}
P[\xi(k)]=(1-\varepsilon)N[0,R_1(k)]+\varepsilon N[Bu(k),R_1(k)],
\end{equation}
\noindent где $u(k)$ - неизвестный, неслучайный вектор, $B$ - известная матрица соответствующих размеров.
\begin{equation}\label{eq3:optim5}
\hat{x}(k+1)=\Phi\hat{x}(k)+[1-\hat{r}_v(k)BL(k)]K(k)\Delta y,
\end{equation}

\begin{equation}\label{eq3:optim5_1}
L(k)=[B^TVv^{-1}(k)B]^{-1}B^TV^{-1}(k),
\end{equation}

\begin{equation}\label{eq3:optim5_2}
Vv(k)H(k)V(k,k-1)H^T(k)+R_1(k),
\end{equation}

\begin{equation}\label{eq3:optim5_3}
V(k|k-1)=\Phi(k-1)V(k-1)\Phi^T(k-1)+N_\xi,
\end{equation}

\begin{equation}\label{eq3:optim5_4}
K(k)=V(k|k-1)H^T(k)[H(k)V(k|k-1)H^T(k)+R_1(k)]^{-1},
\end{equation}

\begin{equation}\label{eq3:optim5_5}
\begin{split}
V(k)=&[I-K(k-1)H(k)]V(k,k-1)[I-K(k-1)H(k)]^T+\\
&+K(k)R_1(k)K^T(k)+\hat{r}_vK(k)BD(k)B^TK^T(k),
\end{split}
\end{equation}

\begin{equation}\label{eq3:optim5_6}
D(k)=[B^TV^{-1}(k)B]^{-1},
\end{equation}

\begin{equation}\label{eq3:optim5_7}
\hat{r}_v(k)= \;
\begin{cases}
0, \; ||l(k)||\leq c_2; \\    
1, \; ||l(k)||> c_2,    
\end{cases}
\end{equation}

\begin{equation}\label{eq3:optim5_8}
l(k)=\Delta y^TV^{-1}(k)B[B^TV^{-1}(k)B]^{-1}B^TV^{-1}(k)\Delta y.
\end{equation}

Из \cite{Klekis} отметим, что алгоритмы (\ref{eq3:optim4})-(\ref{eq3:optim4_5}) и (\ref{eq3:optim5})-(\ref{eq3:optim5_8}) уступают по точности второму алгоритму фильтрации, но дают более точные оценки, чем ФКБ.
Особенно это характерно в случае мощных выбросов.
По точности алгоритмы (\ref{eq3:optim4})-(\ref{eq3:optim4_5}) и (\ref{eq3:optim5})-(\ref{eq3:optim5_8}) различаются незначительно, однако в отличие от первого второй не требует информации о характеристиках выбросов

\begin{table} [h]
  \centering
  \parbox{15cm}{\caption{Дисперсия ошибок оценивания в момент $k=20$. $\sigma_{OPT}^2$ - для оптимального фильтра (\ref{eq3:optim2})-(\ref{eq3:optim2_5}), $\sigma_{LIN}^2$ - для линейного фильтра (\ref{eq3:optim3})-(\ref{eq3:optim3_5}), $\sigma_{KAL}^2$ - для ФКБ, $\sigma_{RB1}^2$ - для алгоритма (\ref{eq3:optim4})-(\ref{eq3:optim4_5}), $\sigma_{RB2}^2$ - для алгоритма (\ref{eq3:optim5})-(\ref{eq3:optim5_8}) \cite{Klekis}} \label{disp_opt}} 
\begin{center}
\begin{tabular}{|l|l|l|l|l|l|l|l|} \hline \hline
$R_1=1$ & $\varepsilon$ & $R_2$ & $\sigma_{OPT}^2$ & $\sigma_{LIN}^2$ & $\sigma_{KAL}^2$ & $\sigma_{RB1}^2$ & $\sigma_{RB2}^2$\\\hline \hline
0,1 & 0,05 & 9 & 0,210 & 0,247 & 0,248 & 0,232 & 0,234\\\hline \hline
0,1 & 0,05 & 36 & 0,211 & 0,314 & 0,367 & 0,222 & 0,222\\\hline
0,1 & 0,05 & 100 & 0,211 & 0,386 & 0,655 & 0,223 & 0,223\\\hline
0,1 & 0,2 & 9 & 0,234 & 0,308 & 0,381 & 0,287 & 0,291\\\hline
0,1 & 0,2 & 36 & 0,235 & 0,410 & 0,921 & 0,277 & 0,273\\\hline
0,1 & 0,2 & 100 & 0,235 & 0,469 & 2,182 & 0,263 & 0,262\\\hline
1 & 0,05 & 9 & 0,633 & 0,748 & 0,782 & 0,744 & 0,746\\\hline
1 & 0,05 & 36 & 0,638 & 1,129 & 1,391 & 0,763 & 0,761\\\hline
1 & 0,05 & 100 & 0,639 & 1,697 & 2,823 & 0,770 & 0.761\\\hline
1 & 0,2 & 9 & 0,792 & 1,093 & 1,332 & 1,066 & 1,072\\\hline
1 & 0,2 & 36 & 0,829 & 1,951 & 3,659 & 1,377 & 1,407\\\hline
1 & 0,2 & 100 & 0,835 & 2,861 & 9,156 & 1,258 & 1,286\\\hline
\end{tabular}
\end{center}
\end{table}

Рассмотренный ряд рекурсивных алгоритмов ФКБ показывает возможности их эффективного использования в условиях хорошо параметризированной статистической ситуации.
В телекоммуникационных системах сам трафик представляет собой сугубо нестационарный случайный процесс и как показали последние исследования, этот процесс обладает значительным последействием и самоподобными свойствами, что существенно затрудняет его параметризацию.
С другой стороны, рекурсивные фильтры Калмана-Бьюси обладают свойствами получения оценки состояния трафика в реальном масштабе времени, что позволяет использовать его непосредственно после оценки для управления джиттером.
Поэтому возникает задача поиска алгоритма, обладающего эффективностью ФКБ и одновременно нечувствительного к нестационарным изменениям математической модели.
Имеется ряд непараметрических алгоритмов, так называемых, алгоритмов свободных от распределения. Найдем решение в рамках этих алгоритмов


\section{Обзор робастных алгоритмов фильтрации на основе фильтра Калмана для случайных процессов, содержащих выбросы и скачки} \label{sect3_grfk}

Метод РФКБ для случайного процесса, содержащего выбросы, согласно \cite{RobustFilter} выглядит следующим образом (рис. \ref{img3:kalmanV}):
\nomenclature{РФКБ}{Робастный Фильтр Калмана-Бьюси}
\begin{equation}\label{eq3:skachok}
\hat{x}(k+1)=\Phi(k+1,k)\hat{x}(k)+K(k)\Delta y\cdot min\left\{1,\frac{b}{|K(k)\Delta y|}\right\},
\end{equation}

\noindent где $b$ является некоторым ограничителем изменения значения функции. 
Это позволяет решить проблему неограниченного изменения оценки за один шаг в классическом фильтре Калмана, оставаясь при этом достаточно простой.

Если $b\geq |K(k) \Delta y |$, то $min\left\{1,\frac{b}{|K(k)\Delta y|}\right\}$ принимает значение 1 и фильтр работает в обычном режиме как ФКБ (\ref{eq3:Estim_rel}). Если же $b\leq |K(k) \Delta y |$, то из этого следует, что произошел выброс и невязка умножается на понижающий коэффициент, равный $\frac{b}{|K(k)\Delta y|}$, что опять же приводит РФКБ к обычному виду (\ref{eq3:Estim_rel}).

\begin{figure} [h]
  \center
\includegraphics[width=0.8\textwidth]{3chapter/output.eps}
  \caption{Схема РФКБ для фильтрации случайных процессов содержащих выбросы}
  \label{img3:kalmanV}
\end{figure}

Метод РФКБ для случайного процесса, содержащего скачки, согласно \cite{RobustFilter} выглядит следующим образом (рис. \ref{img3:kalmanS}):

\begin{equation}\label{eq3:vibros}
\begin{split}
\hat{x}(k+1)=&\Phi(k+1,k)\hat{x}(k)+H(k)[I-H(k)K(k)\Delta y]\times \\
&\times min\left\{1,\frac{b}{|I-H(k)K(k)\Delta y|}\right\},
\end{split}
\end{equation}

\noindent где $b$ тот же аргумент, ограничивающий изменение значения функции, что и для РФКБ для ситуации выброса (\ref{eq3:skachok}).


\begin{figure} [h]
  \center
\includegraphics[width=0.8\textwidth]{3chapter/output1.eps}
  \caption{Схема РФКБ для фильтрации случайных процессов содержащих скачки}
  \label{img3:kalmanS}
\end{figure}

Гибридный робастный фильтр Калмана (ГРФКБ)
\nomenclature{ГРФКБ}{Гибридный Робастный Фильтр Калмана-Бьюси}
Очевидно, одновременная фильтрация возможна только с некоторой задержкой $\Delta \tau$. 
Это необходимо для принятия решения о типе отклонения от нормального распределения. 
Вследствие выброса скорей всего увидим один большой выброс (\ref{eq3:v}), а вследствие скачка – подряд целую последовательность (\ref{eq3:s}). 
ГРФКБ может быть реализован следующим образом \cite{RobustFilter}: РФКБ для случайного процесса с выбросами работает по умолчанию и всякий раз, когда ширина выброса больше, чем окно наблюдения $\Delta \tau$, единожды используется процедура РФКБ для случайных процессов со скачками.
Формализуем описанный алгоритм:
\begin{equation}\label{eq3:syntes1}
\begin{split}
\hat{x}(k+1)=&\Phi(k+1,k)\hat{x}(k)+(1-\eta)K(k)\Delta y\times \\
&\times min\left\{1,\frac{b}{|K(k)\Delta y|}\right\}+\eta H(k)[I-H(k)K(k)\Delta y] \times\\
&\times\left\{1,\frac{b}{|I-H(k)K(k)\Delta y|}\right\},
\end{split}
\end{equation}

\begin{equation}\label{eq3:syntes2}
\eta= \;
\begin{cases}
0, \; cond(k) \\    
1, \; cond(k),    
\end{cases}
\end{equation}
\noindent где $cond(k)$ - функция, которая определяет, произошел ли скачок задержки в окне наблюдения или нет:
\begin{lstlisting}[language=Python]
 1  def cond(arr, w, b):  
 2    try:  # check that the number of elements in
 3          # the array is less than the viewing window
 4      arr[-w] 
 5    except IndexError:
 6      return False
 7    if arr[-w]<b:
 8      return False
 9    if w==1 and arr[-w]>=b:
 10      return True
 11   if k==1 and arr[-w]<b:
 12     return False
 13   else:
 14     if cond(arr, w-1, b):
 15       return True  # detected nonstationarity delay
 16     else:
 17       return False  # no detected nonstationarity delay
\end{lstlisting}


\cite{RePEc:spr:stmapp:v:17:y:2008:i:1:p:13-40}

\section{Обзор методов выбор высоты отсечения $b$}
Чтобы выбрать высоту отсечения $b$ \cite{huber1,huber2}, сделаем простое допущение, что условное математическое ожидание $E[\Delta x(k)|\Delta y(k)]$ линейное, где $\Delta x=x(k)-\hat x(k)$, 
которое является верным только приблизительно. В этих условиях есть два предложения:
Первый критерий Анскомб страхования. 
Для данного предложения <<страховая премия>> $\sigma$, подлежит уплате в условиях потери эффективности в идеальной модели по сравнению с оптимальной процедурой в этих (идеальных) условиях, 
то есть для классического фильтра Калмана выбираем $b=b(\sigma)$ такое, что для выброса:

\begin{equation}
\begin{split}
&E\bigg|\Delta x(k)-H(k)[I-H(k)K(k)\Delta y] \times\\
& \times min\left\{1,\frac{b}{|I-H(k)K(k)\Delta y|}\right\}\bigg|=(1+\sigma)E|\Delta x(k)-K(k)\Delta y|, 
\end{split}
\end{equation}
и для скачка:
\begin{equation}
\begin{split}
&E\left|\Delta x(k)-K(k)\Delta y\cdot min\left\{1,\frac{b}{|K(k)\Delta y|}\right\}\right|=\\
&(1+\sigma)E|\Delta x(k)-K(k)\Delta y|.
\end{split}
\end{equation}

Другую возможность дает размер окрестности $U_r$, определенный радиусом $r\in[0,1]$.
Определим $b=b(r)$ такое что:

\begin{equation}
(1-r)E|K(k)\Delta y-b|_+=rb.
\end{equation}

Если радиус неизвестен, можно воспользоваться идеей разработанной \cite{RePEc:spr:stmapp:v:17:y:2008:i:1:p:13-40,citeulike:6486145}, которая позволяет определить наименьший благоприятный радиус $r_0$ с помощью следующих уравнений:
\begin{equation}
r_0=argmin_{s\in[0,1]}\rho_0(s),
\end{equation}

\begin{equation}
\rho_0(s)=max_{r\in[0,1]}\rho(r,s),
\end{equation}

\begin{equation}
\rho(r,s)=\frac{max_{Ur}MSE(rLS(b(s)))}{max_{Ur}MSE(rLS(b(r)))},
\end{equation}

\noindent где $s$ радиус фиксированного размера $s\in[0,1]$ симметричной окрестности загрязнения идеального случайного процесса $P(k)$, который предполагается симметричен относительно $0$:
\begin{equation}
Q(k)=(1-s)P(k)+sZ(k),
\end{equation}
\noindent где $Z(k)$ является случайным процессом с неизвестной вероятностью, который симметричен относительно $0$.

Если знания о $r$ ограничены, скажем $r\in[r_l,r_u]$, $0<r_l<r_u<1$, мы можем ограничить диапазон изменения $s$ и $r$, для этого определив:
\begin{equation}
A_r=E\left[trCov[\Delta x(k)|\Delta y(k)]+(|K(k)\Delta y|-b(r))_+^2\right],
\end{equation}
\begin{equation}
B_r=E\left[|K(k)\Delta y|^2-(|K(k)\Delta y|-b(r))^2_+\right]+b^2(r),
\end{equation}
\begin{equation}
\rho_0(s)=max\{A_r/A_{rl},B_r/B{ru}\}.
\end{equation}

\section{Сравнительный анализ алгоритмов фильтрации для случайных процессов джиттера, содержащего выбросы и скачки} \label{sect3_6}
Чтобы сравнить алгоритмы фильтрации проведем моделирование оценки случайного процесса с помощью приведенных робастных алгоритмов фильтрации и фильтра Калмана параметрами, 
используемые для построения рис. \ref{img:3typeJitter} и с $r_v=0,01$, $r_s=0,001$. 
Результаты приведены на рис. \ref{img3:filterIdeal}-\ref{img3:filterMix}. 
Сплошной линией со снежинками показан наблюдаемый процесс, 
сплошной – оценка ФКБ, штрихпунктирной с точками – РФКБ для ситуации с выбросами, штрихпунктирной - РФКБ для ситуации со скачками и штрихпунктирной со снежинками – ГРФКБ. 
На рис. \ref{img3:filterIdeal} представлены результаты оценивания временного процесса без выбросов и скачков (\ref{eq3:Estim}), 
из графика следует, что рассмотренные робастные алгоритмы, не теряют своей оптимальности по сравнению с ФКБ, во время оценивания процесса без выбросов и скачков.
На рис. \ref{img3:filterVibros} представлены результаты оценивания временного процесса с выбросами (\ref{eq3:v}), 
из графика следует, что РФКБ для ситуации выброса и ГРФКБ позволяют игнорировать выбросы, что обеспечивает оптимальную оценку процесса.
На рис. \ref{img3:filterSkachok} представлены результаты оценивания временного процесса со скачками (\ref{eq3:v}), 
из графика следует, что РФКБ для ситуации скачка и ГРФКБ позволяют быстро переключиться на новое значение задержки. 
В то время как РФКБ для ситуации выброса оказался не в состоянии отслеживать скачки.
В заключение, на рис. \ref{img3:filterMix} представлены результаты оценивания временного процесса со скачками и с выбросами, из графика следует, что, 
ГРФКБ позволяет получить оптимальную оценку в смешанной ситуации, в то время как остальные алгоритмы выполняют оценку недопустимо плохо.


\pgfplotsset{width=15cm, height=10cm, compat=1.3}
\begin{figure} [!h]
  \center
\begin{tikzpicture}
%\pgfkeys{/pgfplots/legend pos=north west}

\begin{axis}[
mark options={scale=0.5},
ylabel={Mem [GB]},
legend style={
%area legend,
at={(0.5,-0.20)},
anchor=north,
legend columns=3},
legend cell align=left,
cycle list name=mark list,
%cycle list name=linestyles,
xlabel=Порядковый номер пакета,
ylabel=Задержка (мс),
xmin=200,
xmax=300
]

\input{graphs/2}

\legend{Задержка, ФКБ, РФКБ(выбросы), РФКБ(скачки), ГРФКБ}
\end{axis}
\end{tikzpicture}
\caption{Моделирование фильтрации в идеальных условиях}
  \label{img3:filterIdeal}
\end{figure}

\pgfplotsset{width=15cm, height=9cm, compat=1.3}
\begin{figure} [!h]
  \center
\begin{tikzpicture}
%\pgfkeys{/pgfplots/legend pos=north west}

\begin{axis}[
mark options={scale=0.5},
ylabel={Mem [GB]},
legend style={
%area legend,
at={(0.5,-0.2)},
anchor=north,
legend columns=3},
legend cell align=left,
cycle list name=mark list,
%cycle list name=linestyles,
xlabel=Порядковый номер пакета,
ylabel=Задержка (мс),
xmin=0,
xmax=40
]

\input{graphs/3}

\legend{Задержка, ФКБ, РФКБ(выбросы), РФКБ(скачки), ГРФКБ}
\end{axis}
\end{tikzpicture}
\caption{Моделирование фильтрации при выбросах}
  \label{img3:filterVibros}
\end{figure}



\pgfplotsset{width=15cm, height=9cm, compat=1.3}
\begin{figure} [!h]
  \center
\begin{tikzpicture}
%\pgfkeys{/pgfplots/legend pos=north west}

\begin{axis}[
mark options={scale=0.5},
ylabel={Mem [GB]},
legend style={
%area legend,
at={(0.5,-0.2)},
anchor=north,
legend columns=3},
legend cell align=left,
cycle list name=mark list,
%cycle list name=linestyles,
xlabel=Порядковый номер пакета,
ylabel=Задержка (мс),
xmin=280,
xmax=350
]

\input{graphs/3}

\legend{Задержка, ФКБ, РФКБ(выбросы), РФКБ(скачки), ГРФКБ}
\end{axis}
\end{tikzpicture}
\caption{Моделирование фильтрации при скачках}
  \label{img3:filterSkachok}
\end{figure}

\clearpage

\pgfplotsset{width=15cm, height=10cm, compat=1.3}
\begin{figure} [!h]
  \center
\begin{tikzpicture}
%\pgfkeys{/pgfplots/legend pos=north west}

\begin{axis}[
mark options={scale=0.5},
ylabel={Mem [GB]},
legend style={
%area legend,
at={(0.5,-0.2)},
anchor=north,
legend columns=3},
legend cell align=left,
cycle list name=mark list,
%cycle list name=linestyles,
xlabel=Порядковый номер пакета,
ylabel=Задержка (мс),
xmin=380,
xmax=480оторую вы делали.
]

\input{graphs/3}

\legend{Задержка, ФКБ, РФКБ(выбросы), РФКБ(скачки), ГРФКБ}
\end{axis}
\end{tikzpicture}
\caption{Моделирование фильтрации в смешанной ситуации скачков и выбросов}
  \label{img3:filterMix}
\end{figure}


\nomenclature{СКО}{Средний Квадрат Отклонений}

%В процессе эксперимента в одной реализации был получен эмпирический средний квадрат отклонений (СКО) оценки в различных ситуациях зашумленности (скачки и выбросы) с помощью рассмотренных фильтров и результаты приведены в табл. \ref{fkDiffSit}

Исследования СКО оценок джиттера задержки для рассмотренных алгоритмов выполнялись методом прямого вероятностного моделирования.
В случае отсутствия скачков и выбросов задержки эмпирические оценки СКО погрешности фильтрации задержки пакетов были получены путем усреднения по времени одной реализации объемом $10^5$ отсчетов.
При оценке ошибки фильтрации задержки с выбросами и скачками оценка выполнялась усреднено по ансамблю реализаций того же объема входных данных на интервалах времени, которые содержат нестационарность.
%Интервал ошибки фильтрации совпадает с началом нестационарности и имеет длительность 40 тактов фильтрации, что чуть больше длительности времени сходимости, рассмотренных фильтров, в худшем случае.
Интервал, на котором расчитывалась ошибка фильтрации для каждого выброса и скачка, в работе был выбран равным 40 тактам работы фильтра.

\begin{table} [!h]
  \centering
  \parbox{15cm}{\caption{СКО оценки фильтров в разных ситуациях зашумленности}\label{fkDiffSit}}
\begin{tabular}{|p{3cm}|p{3cm}|p{3cm}|p{3cm}|p{3cm}|}
    \hline
    Тип фильтра        & Условия без выбросов и скачков & Условия с выбросами & Условия со скачками  & Условия с выбросами и скачками \\ \hline
    ФКБ                 & \textbf{0,1327}                 & 0,1722                   & 0,6024                 & 0,2371                           \\ \hline
    РФКБ (для выбросов) & 0,1685                          &  \textbf{0,163}       & 0,6515                 & 0,3052                           \\ \hline
    РФКБ (для скачков)   & 0,135                           & 0,19               & \textbf{0,5024}                & 0,2630                             \\ \hline
    ГРФКБ               & 0,139                          & 0,168               &   0,5523            & \textbf{0,1869}                           \\ \hline
    \end{tabular}
\end{table}








Жирным шрифтом выделены лучшие результаты оценок по сравнению с другими фильтрами для каждой шумовой ситуации. Для ситуации с выбросами и скачками наилучший результат показал гибридный робастный фильтр Калмана.








\section{Выводы по третьему разделу} \label{sect:concl3}

\begin{enumerate}
%\item (old) Разработан инвариантный алгоритм буфера компенсации джиттера, который позволяет решить ряд проблем возникающих, 
%когда процесс пакетной задержки отклоняется от нормального распределения и имеет выбросы и скачки. 
%Сравнительный анализ работы предложенного алгоритма с реальными задержками, 
%которые были получены при анализе основных источников джиттера в проводных и беспроводных сетях в разделе \ref{chapt2} проведем в разделе \ref{chapt4}.

% \item (old) Проведен анализ алгоритмов фильтрации для оценки текущего состояния случайного процесса содержащего выброси и скачки.
% Выбран алгоритм фильтрации, обладающий рядом необходимых свойств, которые позволяют на его основе реализовать алгоритм буфера компенсации джиттера. 
% Проведен анализ работы выбранного алгоритма с рядом задержек, которые были сгенерированы с помощью математической модели процесса задержки (\ref{eq3:v} и (\ref{eq3:s}). 
% Отметим (табл. \ref{fkDiffSit}), что выбранный алгоритм фильтрации превосходит остальные в условиях с выбросами и скачками.
 
 \item Учитывая нелинейный и нестационарный характер математической модели джиттера, 
 применение классических методов управления, способных скомпенсировать нежелательные скачки и выбросы в рамках линейных процедур, представляется невозможным.
 Отсутствие надежных статистических данных о нестационарной обстановке не дает возможности использовать параметрические методы принятия решений.
 В этих условиях рациональней всего использовать непараметрические, робастные алгоритмы свободные от распределения.
 
  %\item Для компенсации джиттера были рассмотрены алгоритмы, основанные на локально-стационарных моделях, фильтр Калмана-Бьюси, робастные алгоритмы на основе фильтра Калмана-Бьюси такие, 
 %как  алгоритм фильтрации, который может быть синтезирован в том случае, когда в (\ref{eq3:v}), (\ref{eq3:vp}) известны последовательности $\{r_v\}$, $\{R_2(k)\}$, 
 %алгоритм фильтрации при известной вероятности появления выбросов $\varepsilon$ и известных ковариационных матрицах $\{R_2(k)\}$,
 %алгоритм фильтрации с оценкой выбросов, требующий информацию о характеристиках выбросов,
 %алгоритм фильтрации, не требующий информации о вероятности появления и амплитудах выбросов,
 %робастный алгоритм фильтрации на основе фильтра Калмана-Бьюси для случайных процессов содержащих выбросы и скачки.
 
 \item
 В работе рассмотрены различные состояния статистики процесса джиттера и разработаны робастные алгоритмы, как для стационарного, так и для нестационарного состояния.
 Общей моделью наблюдения для этих алгоритмов является модель засоренного распределения Хьюберта.
 
 \item Для нестационарной обстановки, преимущественно имеющей место на практике, предложено использовать рекурсивные методы оценки и управления джиттером.
 К рекурсивным методам, реализованным в пространстве состояний, относятся методы стохастической аппроксимации, которые оптимальны для оценки случайных величин, 
 а также фильтры Калмана-Бьюси, которые оптимальны для случайных процессов.
 
 \item С использованием модернизированных уравнений состояния и наблюдения удалось синтезировать робастные процедуры оценки состояния джиттера, 
 основываясь на выборе универсального вида управления --- управление наблюдением.
 Робастный фильтр Калмана-Бьюси удалось представить в виде гибридного алгоритма, который при оценке случайных процессов содержащих скачки и выбросы, 
 обеспечивает переход из одного режима в другой автоматически.
 Предложенный метод является универсальным для решения широкого круга задач при неопределенной статистике в частности в алгоритмах, 
 которые содержат процедуры автоматического выбора режима оценки с ориентацией на наличие выбросов и скачков.
 
 \item Проведен сопоставительный анализ качества оценивания джиттера для различных модернизаций фильтра Калмана-Бьюси и получены численные данные.
 При сопоставлении полученных результатов с данными оптимального фильтра оказалось, что модернизированный фильтр обладает устойчивым режимом в широком диапазоне изменения статистических параметров.
 %и представленные значения апостериорной дисперсии, позволяют оценить выигрыш или проигрыш той или иной процедуры.
 

 
 %Принято решение в качестве основного алгоритма использовать робастный алгоритм свободный от распределения и обладающий теми свойствами, что в условиях априорной неопределенности не уступают параметрическим алгоритмам.
 

 
 
 \item Проведен сравнительный анализ ряда робастных и традиционных линейных алгоритмов. 
 В результате анализа оказалось, что робастные алгоритмы имеют время сходимости, исчисляемое 3-5 шагами, в то время как линейные сходятся за 50-100 шагов.
 Было проведено исследование точности робастных алгоритмов.
 Как показал анализ, в установившемся режиме робастные и линейные алгоритмы сопоставимы по эффективности: их апостериорные дисперсии практически идентичны.
 В ситуации скачка или выброса линейные алгоритмы, как правило, расходятся, в то время как робастный дает устойчивую оценку.
 
 %в ситуации с выбросами и скачками наилучший результат показал гибридный робастный фильтр Калмана показав на 20\% меньшее СКО, чем ФКБ.

 \item Учитывая возможность использования теоремы о разделении, алгоритм управления компенсацией джиттера может состоять из двух частей: оптимальной оценки стохастического процесса и детерминированного управления, как функции от оценки.
 В качестве управления может быть использован алгоритм управления состоянием или наблюдением.
 Как в том, так и в другом случае алгоритм оценки остается практически неизменным.
%  \item Использование потоковых агентов позволяет решить проблему внедрения предложенного буфера компенсации джиттера в сеть LTE, избегая при этом дополнительных затрат так, как его внедрение можно реализовать простым обновлением программного обеспечения на SGW/PGW узле. Также ПА на данный момент уже имет целый ряд полезных функций, которые решают множество проблем на границе разделения сред для потокового трафика.
 \end{enumerate}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% преместит это выводы
%Рассмотренные алгоритмы обладают рядом недостатков:
%\begin{enumerate}
% \item Алгоритм ФКБ дает решение оптимального оценивания в линейных динамических системах при гауссовском распределение помех, а при отклонении от норамального распределения (выбросы и скачки) качество оценивания существенно ухудшаются.
% \item Для реализации 2-4 алгоритмов необходима априорная информация о характеристиках выбросов, а так как телекоммуникационные системы нестационарны, то практическое применение этих алгоритмов в таких системах ограничено.
% \item Ни один алгоритм не учитывает особенностей, которые необходимо учитывать при фильтрации случайного процесса содержащего скачки.
%\end{enumerate}
%Для решения этих недостатков рассмотрим ряд робастных алгоритмов фильтрации из \cite{RobustFilter}.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

