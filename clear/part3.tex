\chapter{Синтез алгоритма буфера компенсации джиттера прибытия пакетов на основе робастного фильтра Калмана} \label{chapt3}

\section{Обзор алгоритмов фильтрации} \label{sect_analis_filters}


В стационарном состоянии сети задержка $x(t)$ представляет собой случайную величину, распределение вероятностей которой близкое к нормальному $N(0,\xi_x)$. 
Однако реальная статистика сети не является стационарной, как мы видим из второго раздела. Таким образом возникают флуктуации задержки, которые могут иметь как единичный характер так и продолжаться длительное время.
Все это приводит к тому, что плотность $p(x)$ нельзя считать идеально распределенной. 
Более того, реальную статистику, как правило, не удается параметризировать. Поэтому традиционные, хорошо разработанные параметрические процедуры для оценки задержки приминить сложно и рисковано. 
В этом случае имеет смысл перейти к непараметрическим робастным алгоритмам, которые хоть и не являются оптимальными, однако отличаются устойчивостью и при прочих равных условиях не проигрывают параметрическим.

Интерес к робастной обработке возник из осознания того факта, что исследователь никогда не располагает полными знаниями о действительной статистике.
Кроме того, предположение о гауссовом характере мешающих воздействий слишком идеализировано.
Как правило, мешающие воздействия имеют небольшой процент аномальных ``выбросов'', что приводит к утяжелению хвостов распределения. 
Эта статистическая неопределенность, а также наличие аномалий может быть учтена в модели ``засоренного'' распределения, предложенного Хьюбером \cite{huber}.

\begin{equation}\label{eq3:huber}
F(x)=(1-\varepsilon)F_0(x)+\varepsilon F_1(x),
\end{equation}
\noindent где $\varepsilon$ - небольшое положительное действительное число $(\varepsilon<0,1)$, $F_0(x)$ - известное распределение, $F_1(x)$ - распределение, принадлежащее некоторому классу, симметричное с конечной дисперсией.

Далее при построении алгоритма за оcнову взят принцип минимакса, т.е. алгоритм строится в рассчете на наименее благоприятное распределение.

Используем такой подход к построению алгоритма оценки процесса $S(\varphi)$. 
В качестве модели помех используем модель ``засоренного'' нормального распределения. 

\begin{equation}\label{eq3:kustov}
W(k)=(1-\varepsilon)N(0,\sigma)+\varepsilon N_1(0,\sigma_1),
\end{equation}

\noindent где $N(0,\sigma)$ и $N_1(0,\sigma_1)$ - нормальные распределения с нулевыми математическими ожиданиями и дисперсиями $\sigma$ и $\sigma_1$. 
Такая модель является наиболее характерной: составляющая $N_1$ описывает аномальную долю помех; составляющая $N$ прочие помехи, имещие вид гауссовых.

Тогда плотность совместного распределения аддитивной смеси сигнала и шума будет иметь вид:
\begin{equation}\label{eq3:kustov1}
W(V)=\frac{1-\varepsilon}{\sigma \sqrt{2\pi}}exp\frac{(V-S)^2}{2\sigma^2}+\varepsilon\frac{1}{\sigma_1\sqrt{2\pi}}exp\frac{(V-S)^2}{2\sigma_1^2},
\end{equation}

\noindent где $V=S(t)+n(t)$ - наблюдение процесса $S(\varphi)$.

Если наблюдение производится в дискретные моменты времени, то функция правдоподобия фазы $\varphi$ может быть записана в виде:

\begin{equation}\label{eq3:kustov2}
\begin{split}
L(\varphi)=&\prod_{i=1}^M \{(1-\varepsilon)\frac{1}{\sigma\sqrt{2\pi}}exp-\frac{[V_i-S_i(\varphi)]^2}{2\sigma^2}+\\
&+\varepsilon\frac{1}{\sigma_1\sqrt{2\pi}}exp-\frac{[V_i-S_i(\varphi)]^2}{2\sigma_1^2} \}.
\end{split}
\end{equation}

Для определения алгоритма оценки воспользуемся методом максимума функции правдоподобия \cite{tihonov}, т.е. в качестве оценки примем значение фазы $\hat{\varphi}$, являющейся решением уравнения:
\begin{equation}\label{eq3:kustov3}
\frac{dL}{d\varphi}/_{\varphi=\hat{\varphi}}=0.
\end{equation}

Подставим в уравнение (\ref{eq3:kustov3}) значение функции правдоподобия (\ref{eq3:kustov2}), получим уравнение:

\begin{equation}\label{eq3:kustov4}
\begin{split}
&\sum_{i=1}^M\left[\frac{V_i-S_i(\varphi)}{\sigma^2}\right]\frac{dS(\varphi)}{d\varphi}-\\
&-\sum_{i=1}^M\frac{\frac{\varepsilon}{1-\varepsilon}\frac{\sigma_1^2-\sigma^2}{\sigma_1^3\sigma}[V_i-S_i(\varphi)]\frac{dS_i(\varphi)}{d\varphi}exp\left\{\frac{\sigma_1^2-\sigma^2}{2\sigma_1^2\sigma^2}[V_i-S_i(\varphi)]\right\}}{1+\frac{\varepsilon}{1-\varepsilon}exp\left\{\frac{\sigma_1^2-\sigma^2}{2\sigma_1^2\sigma^2}[V_i-S_i(\varepsilon)]^2\right\}}=0.
\end{split}
\end{equation}

Типичным для практики являются следующие значения величин: $\varepsilon\leq0,1$ и $\sigma_1\geq10\sigma$.

Рассмотрим вторую сумму. Если $V_i\geq3\sigma_1$, то единицей в знаминателе можно пренебречь и тогда этот член в сумме имеет вид:
\begin{equation}\label{eq3:kustov5}
\frac{1}{\sigma^2}[V_i-S_i(\varphi)]\frac{dS(\varphi)}{d\varphi},
\end{equation}
\noindent т.е. равен соответствующему члену первой суммы, а их разность равна 0, т.е. в оптимальном алгоритме при обработке эти члены не учитываются.

Если $V_i\leq3\sigma$, то вторым членом в знаминателе второй суммы можно пренебречь по сравнению с единицей. Числитель второй суммы будет иметь значение $\leq0,01$ и этими состовляющими первой суммы можно пренебречь.

Рассмотренная процедура оценки является точечной, привязанной к конкретной ситуации. В этой процедуре, не учитывается предистория и не используется экстраполяция, что для решений сетевых задач имеет принципиальное значение. 
Очевидно, можно создать процедуру, состоящую из последовательности точечных оценок в каждой из временных позиций по алгоритму (\ref{eq3:kustov4}).
Но данная процедура не ориентирована на учет параллельных связей между соседними позициями $i$ и $i+1$.

Применим более общую марковскую модель функционирования сети, при которой соседние позиции связаны соотношением:
\begin{equation}\label{eq3:kustov6}
x(i+1)=P(x_{i+1}/x_i)x(i),
\end{equation}
\noindent где $P(x_{i+1}/x_i)$ - вероятность перехода, представляющая по сути коэффициент изменения между указанными позициями процесса $x(i)$.

Выбор модели (\ref{eq3:kustov6}) позволяет построить рекурсивную процедуру, как самой модели состояния процесса $x(i)$, так и алгоритма оценки в виде фильтра Калмана-Бьюси или в виде более простой процедуры стохастической апроксимации.










Фильтр Калмана-Бьюси дает решение задачи оптимального оценивания в линейных динамических системах при гауссовском распределение помех.
Однако в нашей прикладной задаче, распределение шумов не является гауссовским, причем распространенной причиной отклонения распределения вероятностей помех от гауссовского является наличие выбросов и скачков в оцениваемом процессе.
Хорошо известно \cite{cipkin}, что такие отклонения существенно ухудшают качество оценок, получаемых с помощью алгоритмов, оптимальных для гауссовских помех.
Поэтому не случайно большое внимание удуляется разаработке робастных алгоритмов фильтрации, стабильно работающих в условиях, когда помехи содержат выбросы или скачки \cite{Klekis, masreliez_ieee, masreliez_martin, ershov_lipcer, ershov, RobustFilter}.
В \cite{masreliez_ieee} задача фильтрации при наличие выбросов решалась, как задача   негаусовской фильтрации, однако реализация полученного алгоритма на ЭВМ представляет затруднительные трудности. 
Дальнейшее развитие этот подход получил в \cite{masreliez_martin}. Однако этот алгоритм фильтрации имеет ряд недостатков: для его построения необходимо знать вероятность появления выброса и распределение вероятностей помех должно быть симметричным. Данный подход не подходит для решения нашей задачи, так как задержка в телекоммуникационных системах является нестационарной.

Другой подход к решению задачи фильтрации помех, содержащих выбросы, представлен в \cite{ershov_lipcer, ershov}. В представлении шумов предполагается, что с большей вероятностью помехи измерения распределены нормально с нулевым средним и заданной ковариационной матрицей и с малой вероятностью распределны также нормально,  но с ковариационной матрицей, имеющей большую норму. Алгоритм фильтрации основан на обнаружении момента появления выброса и изменении коэффициента усиления в зависимости от результатов обнаружения. Для модификации коэффициента используется ковариационная матрица источников выбросов.

В \cite{Klekis} предполагается, что в нормальном режиме работы измерительного устройства помехи распределены нормально с нулевым средним и известной ковариационной матрицей, а в режиме сбоев помехи имеют нормальное распределение с неизвестным средним и той же ковариационной матрицей.
Алгоритм фильтрации получен на основе обнаружения момента появления выброса, оценивания его амплитуду и соответственно модифицируя коэффициент усиления и ковариационную матрицу. В этом случае априорной информации о характеристиках выбросов не требуется.  

Рассмотрим более детально алгоритмы фильтрации описанные выше:

\textbf{1. Фильтр Калмана (ФК).}
 ФК синтезирован с учетом того, что наблюдаемый процесс соответствует уравнению (\ref{eq3:modelStat}) и наблюдается на фоне гауссовского белого шума.
 Уравнение оценки в виде условного среднего значения задержки с использованием ФК имеет вид:


\begin{equation}\label{eq3:Estim_rel}
\hat{x}(k+1)=\Phi\hat{x}(k)+K(k)\Delta y,
\end{equation}
\noindent где $\Delta y=H\Phi\hat{x}(k)-y(k)$ - невязка, $K(k)$ - коэффициент, обеспечивающий устойчивость и сходимость процедуры, в частности $K(k)$ может быть константой $K\leq1$. Коэффициент усиления ФК $K(k)$ является функцией от апостериорной дисперсии ошибки оценки $V(k)$, что ускоряет его сходимость:

\begin{equation}\label{eq3:K}
K(k)=V(k)H^TN_{\nu}^{-1},
\end{equation}
 
\begin{equation}\label{eq3:V}
V(k)=[I-K(k-1)H(k)]V(k,k-1),
\end{equation}


\begin{equation}\label{eq3:Vkk-1}
V(k,k-1)=\Phi^TV(k-1)\Phi+N_\xi,
\end{equation}

\noindent где $V(k)$ - апостериорная дисперсия ошибки оценки, $V(k,k-1)$ - априорная дисперсия ошибки оценки, $I$ - единичная матрица.

На рис. \ref{img3:kalmanF} представлена схема сглаживающего фильтра, построенная в соответствии с (\ref{eq3:Estim_rel}). Ключевую роль в оценке ФК текущего значения задержки, является параметр $\Phi$ позволяющий регулировать сглаживающие свойства фильтра. 

\begin{figure} [h]
  \center
\includegraphics[width=0.8\textwidth]{3chapter/output2.eps}
  \caption{Схема ФК}
  \label{img3:kalmanF}
\end{figure}


\textbf{2. Алгоритм фильтрации, который может быть синтезирован в том случае, когда в (\ref{eq3:v}), (\ref{eq3:vp}) известны последовательности $\mathbf{\{r_v\}}$, $\mathbf{\{R_2(k)\}}$.} Выражения описывающие алгоритм, имеют вид:

\begin{equation}\label{eq3:optim2}
\hat{x}(k+1)=\Phi\hat{x}(k)+K(k)\Delta y,
\end{equation}

\begin{equation}\label{eq3:optim2_3}
V(k|k-1)=\Phi(k-1)V(k-1)\Phi^T(k-1)+N_\xi,
\end{equation}

\begin{equation}\label{eq3:optim2_4}
\begin{split}
K(k)=&V(k|k-1)H^T(k)\{H(k)V(k|k-1)H^T(k)+\\
&+[1-r_v(k)R_1(k)+r_v(k)R_2(k)\}^{-1},
\end{split}
\end{equation}

\begin{equation}\label{eq3:optim2_5}
V(k)=[I-K(k-1)H(k)]V(k,k-1).
\end{equation}

\textbf{3. Алгоритм фильтрации при известной верояности появления выбросов $\mathbf{\varepsilon}$ и известных ковариационных матрицах $\mathbf{\{R_2(k)\}}$:}

\begin{equation}\label{eq3:optim3}
\hat{x}(k+1)=\Phi\hat{x}(k)+K(k)\Delta y,
\end{equation}

\begin{equation}\label{eq3:optim3_3}
V(k|k-1)=\Phi(k-1)V(k-1)\Phi^T(k-1)+N_\xi,
\end{equation}

\begin{equation}\label{eq3:optim3_4}
\begin{split}
K(k)=&V(k|k-1)H^T(k)[H(k)V(k|k-1)H^T(k)+\\
&+(1-\varepsilon)R_1(k)+\varepsilon R_2(k)]^{-1},
\end{split}
\end{equation}

\begin{equation}\label{eq3:optim3_5}
V(k)=[I-K(k-1)H(k)]V(k,k-1).
\end{equation}

\textbf{4. Алгоритм фильтрации с оценкой выбросов, требующий информацию о характеристиках выбросов:}

\begin{equation}\label{eq3:optim4}
\hat{x}(k+1)=\Phi\hat{x}(k)+K(k)\Delta y,
\end{equation}

\begin{equation}\label{eq3:optim4_3}
V(k|k-1)=\Phi(k-1)V(k-1)\Phi^T(k-1)+N_\xi,
\end{equation}

\begin{equation}\label{eq3:optim4_4}
\begin{split}
K(k)=&V(k|k-1)H^T(k)\{H(k)V(k|k-1)H^T(k)+\\
&+(1-\hat{r}_v(k))R_1(k)+\hat{r}_v(k)R_2(k)\}^{-1},
\end{split}
\end{equation}

\begin{equation}\label{eq3:optim4_5}
\begin{split}
V(k)=&[I-K(k-1)H(k)]V(k,k-1)[I-K(k-1)H(k)]^T+\\
&+K(k)R_1(k)K^T(k).
\end{split}
\end{equation}

\begin{equation}
\hat{r}_v(k)= \;
\begin{cases}
0, \; ||\Delta y(k)||\leq c_1 \\    
1, \; ||\Delta y(k)||> c_1    
\end{cases}
\end{equation}

\textbf{5. Алгоритм фильтрации, не требующий информации о вероятности появления и амплитудах выбросов.} Алгоритм использует следующую модель помех:
\begin{equation}\label{eq3:optim5_01}
\xi(k)=\xi(k)+r_v(k)Bu(k),
\end{equation}
\begin{equation}\label{eq3:optim5_01}
P[\xi(k)]=(1-\varepsilon)N[0,R_1(k)]+\varepsilon N[Bu(k),R_1(k)],
\end{equation}
\noindent где $u(k)$ - неизвестный, неслучайный вектор, $B$ - известная матрица соответствующих размеров.
\begin{equation}\label{eq3:optim5}
\hat{x}(k+1)=\Phi\hat{x}(k)+[1-\hat{r}_v(k)BL(k)]K(k)\Delta y,
\end{equation}

\begin{equation}\label{eq3:optim5_1}
L(k)=[B^TVv^{-1}(k)B]^{-1}B^TV^{-1}(k),
\end{equation}

\begin{equation}\label{eq3:optim5_2}
Vv(k)H(k)V(k,k-1)H^T(k)+R_1(k),
\end{equation}

\begin{equation}\label{eq3:optim5_3}
V(k|k-1)=\Phi(k-1)V(k-1)\Phi^T(k-1)+N_\xi,
\end{equation}

\begin{equation}\label{eq3:optim5_4}
K(k)=V(k|k-1)H^T(k)[H(k)V(k|k-1)H^T(k)+R_1(k)]^{-1},
\end{equation}

\begin{equation}\label{eq3:optim5_5}
\begin{split}
V(k)=&[I-K(k-1)H(k)]V(k,k-1)[I-K(k-1)H(k)]^T+\\
&+K(k)R_1(k)K^T(k)+\hat{r}_vK(k)BD(k)B^TK^T(k),
\end{split}
\end{equation}

\begin{equation}\label{eq3:optim5_6}
D(k)=[B^TV^{-1}(k)B]^{-1},
\end{equation}

\begin{equation}\label{eq3:optim5_7}
\hat{r}_v(k)= \;
\begin{cases}
0, \; ||l(k)||\leq c_2 \\    
1, \; ||l(k)||> c_2    
\end{cases}
\end{equation}

\begin{equation}\label{eq3:optim5_8}
l(k)=\Delta y^TV^{-1}(k)B[B^TV^{-1}(k)B]^{-1}B^TV^{-1}(k)\Delta y,
\end{equation}

Из анализа этих алгоритмов \cite{Klekis} отметим что алгоритмы (\ref{eq3:optim4})-(\ref{eq3:optim4_5}) и (\ref{eq3:optim5})-(\ref{eq3:optim5_8}) уступают по точности второму алгоритму фильтрации, но дают более точные оценки, чем ФК.
Особенно это характерно в случае мощных выбросов.
По точности алгоритмы (\ref{eq3:optim4})-(\ref{eq3:optim4_5}) и (\ref{eq3:optim5})-(\ref{eq3:optim5_8}) различаются незначительно, однако в отличии от первого второй не требует информации о характеристиках выбросов

\begin{table} [h]
  \centering
  \parbox{15cm}{\caption{Дисперсия ошибок оценивания в момент $k=20$. $\sigma_{OPT}^2$ - для оптимального фильтра (\ref{eq3:optim2})-(\ref{eq3:optim2_5}), $\sigma_{LIN}^2$ - для линейного фильтра (\ref{eq3:optim3})-(\ref{eq3:optim3_5}), $\sigma_{KAL}^2$ - для ФК, $\sigma_{RB1}^2$ - для алгоритма (\ref{eq3:optim4})-(\ref{eq3:optim4_5}), $\sigma_{RB2}^2$ - для алгоритма (\ref{eq3:optim5})-(\ref{eq3:optim5_8}) \cite{Klekis}} \label{disp_opt}} 
\begin{center}
\begin{tabular}{|l|l|l|l|l|l|l|l|} \hline \hline
$R_1=1$ & $\varepsilon$ & $R_2$ & $\sigma_{OPT}^2$ & $\sigma_{LIN}^2$ & $\sigma_{KAL}^2$ & $\sigma_{RB1}^2$ & $\sigma_{RB2}^2$\\\hline \hline
0,1 & 0,05 & 9 & 0,210 & 0,247 & 0,248 & 0,232 & 0,234\\\hline \hline
0,1 & 0,05 & 36 & 0,211 & 0,314 & 0,367 & 0,222 & 0,222\\\hline
0,1 & 0,05 & 100 & 0,211 & 0,386 & 0,655 & 0,223 & 0,223\\\hline
0,1 & 0,2 & 9 & 0,234 & 0,308 & 0,381 & 0,287 & 0,291\\\hline
0,1 & 0,2 & 36 & 0,235 & 0,410 & 0,921 & 0,277 & 0,273\\\hline
0,1 & 0,2 & 100 & 0,235 & 0,469 & 2,182 & 0,263 & 0,262\\\hline
1 & 0,05 & 9 & 0,633 & 0,748 & 0,782 & 0,744 & 0,746\\\hline
1 & 0,05 & 36 & 0,638 & 1,129 & 1,391 & 0,763 & 0,761\\\hline
1 & 0,05 & 100 & 0,639 & 1,697 & 2,823 & 0,770 & 0.761\\\hline
1 & 0,2 & 9 & 0,792 & 1,093 & 1,332 & 1,066 & 1,072\\\hline
1 & 0,2 & 36 & 0,829 & 1,951 & 3,659 & 1,377 & 1,407\\\hline
1 & 0,2 & 100 & 0,835 & 2,861 & 9,156 & 1,258 & 1,286\\\hline
\end{tabular}
\end{center}
\end{table}

Рассмотренные алгоритмы обладают рядом недостатков:
\begin{enumerate}
 \item Алгоритм ФК дает решение оптимального оценивания в линейных динамических системах при гауссовском распределение помех, а при отклонении от норамального распределения (выбросы и скачки) качество оценивания существенно ухудшаются.
 \item Для реализации 2-4 алгоритмов необходима априорная информация о характеристиках выбросов, а так как телекоммуникационные системы нестационарны, то практическое применение этих алгоритмов в таких системах ограничено.
 \item Ни один алгоритм не учитывает особенностей, которые необходимо учитывать при фильтрации случайного процесса содержащего скачки.
\end{enumerate}
Для решения этих недостатков рассмотрим ряд робастных алгоритмов фильтрации из \cite{RobustFilter}.

\section{Обзор робастных алгоритмов фильтрации на основе фильтра Калмана для случайных процессов содержащих выбросы и скачки} \label{sect3_grfk}

\textbf{1. Алгоритм РФК для случайного процесса, содержащего выбросы,} согласно \cite{RobustFilter} выглядит следующим образом (рис. \ref{img3:kalmanV}):

\begin{equation}\label{eq3:skachok}
\hat{x}(k+1)=\Phi(k+1,k)\hat{x}(k)+K(k)\Delta y\cdot min\left\{1,\frac{b}{|K(k)\Delta y|}\right\},
\end{equation}

\noindent где $b$ является некоторым ограничителем изменения значения функции. 
Это позволяет решить проблему неограниченого изменения оценки за один шаг в классическом фильтре Калмана, оставаясь при этом достаточно простой.

Если $b\geq |K(k) \Delta y |$, то $min\left\{1,\frac{b}{|K(k)\Delta y|}\right\}$ принимает значение 1 и фильтр работает в обычном режиме как ФК (\ref{eq3:Estim_rel}). Если же $b\leq |K(k) \Delta y |$, то из этого следует, что произошел выброс и невязка умножается на понижающий коэффициент, равный $\frac{b}{|K(k)\Delta y|}$, что опять же приводит РФК к обычному виду (\ref{eq3:Estim_rel}).

\begin{figure} [h]
  \center
\includegraphics[width=0.8\textwidth]{3chapter/output.eps}
  \caption{Схема РФК для фильтрации случайных процессов содержащих выбросы}
  \label{img3:kalmanV}
\end{figure}

\textbf{2. Алгоритм РФК для случайного процесса, содержащего скачки,} согласно \cite{RobustFilter} выглядит следующим образом (рис. \ref{img3:kalmanS}):

\begin{equation}\label{eq3:vibros}
\begin{split}
\hat{x}(k+1)=&\Phi(k+1,k)\hat{x}(k)+H(k)[I-H(k)K(k)\Delta y]\times \\
&\times min\left\{1,\frac{b}{|I-H(k)K(k)\Delta y|}\right\},
\end{split}
\end{equation}

\noindent где $b$ тот же аргумент, ограничивающий изменение значения функции, что и для РФК для ситуации выброса (\ref{eq3:skachok}).


\begin{figure} [h]
  \center
\includegraphics[width=0.8\textwidth]{3chapter/output1.eps}
  \caption{Схема РФК для фильтрации случайных процессов содержащих скачки}
  \label{img3:kalmanS}
\end{figure}

\textbf{3. Гибридный робастный фильтр Калмана (ГРФК)}

Очевидно, одновременная фильтрация возможна только с некоторой задержкой $\Delta \tau$. 
Это необходимо для принятия решения о типе отклонения от нормального распределения. 
Вследствие выброса скорей всего увидим один большой выброс (\ref{eq3:v}), а вследствие скачка – подряд целую последовательность (\ref{eq3:s}). 
ГРФК может быть реализован следующим образом \cite{RobustFilter}: РФК для случайного процесса с выбросами работает по умолчанию и всякий раз, когда ширина выброса больше, чем окно наблюдения $\Delta \tau$, единожды используется процедура РФК для случайных процессов со скачками.



\section{Сравнительный аналих алгоритмов фильтрации для случайных процессов содержащих выбросы и скачки} \label{sect3_6}
Чтобы сравнить алгоритмы фильтрации проведем моделирование оценки случайного процесса с помощью приведенных робастных алгоритмов фильтрации и фильтра Калмана. Результаты приведены на рис. \ref{img3:filterIdeal}-\ref{img3:filterMix}. Сплошной линией со снежинками показан наблюдаемый процесс, сплошной – оценка ФК, штрихпунктирной с точками – РФК для ситуации с выбросами, штрихпунктирной - РФК для ситуации со скачками и штрихпунктирной со снежинками – ГРФК. На рис. \ref{img3:filterIdeal} представлены результаты оценивания временного процесса без выбросов и скачков (\ref{eq3:Estim}), из графика следует, что рассмотренные робастные алгоритмы, не теряют своей оптимальности по сравнению с ФК, во время оценивания процесса без выбросов и скачков.
На рис. \ref{img3:filterVibros} представлены результаты оценивания временного процесса с выбросами (\ref{eq3:v}), из графика следует, что РФК для ситуации выброса и ГРФК позволяют игнорировать выбросы, что обеспечивает оптимальную оценку процесса.
На рис. \ref{img3:filterSkachok} представлены результаты оценивания временного процесса со скачками (\ref{eq3:v}), из графика следует, что РФК для ситуации скачка и ГРФК позволяют быстро переключиться на новое значение задержки. В то время как РФК для ситуации выброса оказался не в состоянии отслеживать скачки.
В заключение, на рис. \ref{img3:filterMix} представлены результаты оценивания временного процесса со скачками и с выбросами, из графика следует, что, ГРФК позволяет получить оптимальную оценку в смешанной ситуации, в то время как остальные алгоритмы выполняют оценку недопустимо плохо.


\pgfplotsset{width=15cm, height=10cm, compat=1.3}
\begin{figure} [h]
  \center
\begin{tikzpicture}
%\pgfkeys{/pgfplots/legend pos=north west}

\begin{axis}[
mark options={scale=0.5},
ylabel={Mem [GB]},
legend style={
%area legend,
at={(0.5,-0.20)},
anchor=north,
legend columns=3},
legend cell align=left,
cycle list name=mark list,
%cycle list name=linestyles,
xlabel=Порядковый номер пакета,
ylabel=Задержка (мс),
xmin=200,
xmax=300
]

\input{graphs/2}

\legend{Задержка, ФК, РФК(выбросы), РФК(скачки), ГРФК}
\end{axis}
\end{tikzpicture}
\caption{Моделирование фильтрации в идеальных условиях}
  \label{img3:filterIdeal}
\end{figure}

\pgfplotsset{width=15cm, height=9cm, compat=1.3}
\begin{figure} [h]
  \center
\begin{tikzpicture}
%\pgfkeys{/pgfplots/legend pos=north west}

\begin{axis}[
mark options={scale=0.5},
ylabel={Mem [GB]},
legend style={
%area legend,
at={(0.5,-0.2)},
anchor=north,
legend columns=3},
legend cell align=left,
cycle list name=mark list,
%cycle list name=linestyles,
xlabel=Порядковый номер пакета,
ylabel=Задержка (мс),
xmin=0,
xmax=40
]

\input{graphs/3}

\legend{Задержка, ФК, РФК(выбросы), РФК(скачки), ГРФК}
\end{axis}
\end{tikzpicture}
\caption{Моделирование фильтрации при выбросах}
  \label{img3:filterVibros}
\end{figure}



\pgfplotsset{width=15cm, height=9cm, compat=1.3}
\begin{figure} [h]
  \center
\begin{tikzpicture}
%\pgfkeys{/pgfplots/legend pos=north west}

\begin{axis}[
mark options={scale=0.5},
ylabel={Mem [GB]},
legend style={
%area legend,
at={(0.5,-0.2)},
anchor=north,
legend columns=3},
legend cell align=left,
cycle list name=mark list,
%cycle list name=linestyles,
xlabel=Порядковый номер пакета,
ylabel=Задержка (мс),
xmin=280,
xmax=350
]

\input{graphs/3}

\legend{Задержка, ФК, РФК(выбросы), РФК(скачки), ГРФК}
\end{axis}
\end{tikzpicture}
\caption{Моделирование фильтрации при скачках}
  \label{img3:filterSkachok}
\end{figure}

\clearpage

\pgfplotsset{width=15cm, height=10cm, compat=1.3}
\begin{figure} [h]
  \center
\begin{tikzpicture}
%\pgfkeys{/pgfplots/legend pos=north west}

\begin{axis}[
mark options={scale=0.5},
ylabel={Mem [GB]},
legend style={
%area legend,
at={(0.5,-0.2)},
anchor=north,
legend columns=3},
legend cell align=left,
cycle list name=mark list,
%cycle list name=linestyles,
xlabel=Порядковый номер пакета,
ylabel=Задержка (мс),
xmin=380,
xmax=480
]

\input{graphs/3}

\legend{Задержка, ФК, РФК(выбросы), РФК(скачки), ГРФК}
\end{axis}
\end{tikzpicture}
\caption{Моделирование фильтрации в смешанной ситуации скачков и выбросов}
  \label{img3:filterMix}
\end{figure}




В процессе эксперимента был получен средний квадрат отклонений (СКО) оценки в различных ситуациях зашумленности (скачки и выбросы) с помощью рассмотренных фильтров и результаты приведены в табл. \ref{fkDiffSit}



\begin{table} [h]
  \centering
  \parbox{15cm}{\caption{Типы и параметры буфера компенсации джиттера}\label{fkDiffSit}}
\begin{tabular}{|p{3cm}|p{3cm}|p{3cm}|p{3cm}|p{3cm}|}
    \hline
    Тип фильтра        & Условия без выбросов и скачков & Условия со скачками & Условия с выбросами & Условия с выбросами и скачками \\ \hline
    ФК                 & 6,48                           & 6                   & \textbf{2,7}                 & 26,6                           \\ \hline
    РФК (для выбросов) & 11,02                          & 29,93               & 3,2                 & 23,1                           \\ \hline
    РФК (для скчков)   & \textbf{2,15}                           & \textbf{0,85}                & 19,8                & 42                             \\ \hline
    ГРФК               & 31,08                          & 10,93               & 27,4                & \textbf{14,4}                           \\ \hline
    \end{tabular}
\end{table}








Жирным шрифтом выделены лучшие результаты оценок по сравнению с другими фильтрами для каждой шумовой ситуации. Как и предполагалось, для ситуации с выбросами и скачками наилучший результат показал гибридный робастный фильтр Калмана.


\section{Синтез алгоритма буфера компенсатора джиттера} \label{sect3_5}

Размер буфера пересчитывается по формуле (\ref{eq3:playout}) только во время пауз между речевыми потоками, где $\hat{x}(k)$ рассчитывается как:

\begin{equation}\label{eq3:syntes1}
\begin{split}
\hat{x}(k+1)=&(1-\eta) \Phi(k+1,k)\hat{x}(k)+K(k)\Delta y\times \\
&\times min\left\{1,\frac{b}{|K(k)\Delta y|}\right\}+\eta \Phi(k+1,k)\hat{x}(k)+\\
&+H(k)[I-H(k)K(k)\Delta y] min\left\{1,\frac{b}{|I-H(k)K(k)\Delta y|}\right\},
\end{split}
\end{equation}

\begin{equation}\label{eq3:syntes2}
\eta= \;
\begin{cases}
0, \; cond(k) \\    
1, \; cond(k),    
\end{cases}
\end{equation}
\noindent где $cond(k)$ - функция, которая определяет произошел ли скачок задержки в окне наблюдения или нет:
\begin{verbatim}
 1  def cond(arr, w, b):  
 2    try:  # проверка, что количество элементов 
 3          # в массиве не меньше, чем окно наблюдения
 4      arr[-w] 
 5    except IndexError:
 6      return False
 7    if arr[-w]<b:
 8      return False
 9    if w==1 and arr[-w]>=b:
 10      return True
 11   if k==1 and arr[-w]<b:
 12     return False
 13   else:
 14     if cond(arr, w-1, b):
 15       return True  # обнаружен скачек задержки
 16     else:
 17       return False  # не обнаружен скачек задержки
\end{verbatim}

Оценка отклонения $\hat{\nu}(k)$ от условного среднего значения сквозной задержки рассчитывается как:

\begin{equation}\label{eq3:syntes4}
\hat{\nu}(k)=\alpha\cdot\hat{\nu}(k-1)+(1-\alpha)\cdot \nu(k).
\end{equation}

\begin{equation}\label{eq3:syntes3}
\nu^i(k)= \;
\begin{cases}
| \hat{x}(k)-x(k) |, \; K(k)\Delta y \leq b \\    
\nu(k-1), \;  K(k)\Delta y > b,    
\end{cases}
\end{equation}

Для внедрения полученного алгоритма компенсации джиттера в сеть LTE можно воспользоваться концепцией потоковых агентов, которая далее будут рассмотрена.

\section{Обзор концепции потоковых агентов} \label{sect_sa}



При передаче мультимедийной информации по комбинированным сетям с учетом различных механизмов распространения с различными технологиями, важным является выполнение требований по качеству предоставления мультимедийной информации пользователю.
При этом важными являются такие характеристики: задержка, джиттер, число потерянных и поврежденных пакетов. Как показывает практика наибольшие потери качественных характеристик происходят на границах операторских сетей и сетей с различными механизмами распространения.
Возникает необходимость установки соответствующих агентов, обеспечивающих мониторинг на том или ином промежутке сети. Вместе с тем от числа и места этих агентов существенно зависит качество мониторинга.
Потоковый агент (ПА) это агент, который находится на базовой станции на пересечении проводной и беспроводной сети (рис. \ref{img:SA}). Агент просматривает и распознает поток, исследуя заголовки RTP. Агент периодически посылает статистические и обратные сообщения в реальном времени на отправляющий сервер. Статистические обратные связи помогают отправителю проследить проводное состояние сети, что существенно для выполнения надлежащего контроля над перегрузками. С другой стороны, потоковый агент отправляет обратные сообщения в реальном времени, такие как подтверждение пакетов (ACKs), что говорит отправителю о прибытии каждого пакета к агенту корректно и вовремя.


\begin{figure} [h]
  \center
\includegraphics [width=0.95\textwidth] {SA.eps}
  \caption{Использование ПА}
  \label{img:SA}
\end{figure}

Блок формирования находится перед ПА и ограничивает объем отправляемых сообщений, чтобы он не был больше чем полоса пропускания беспроводной сети, храня пакеты, ожидающие фрагментацию и передачу на более низкий уровень. Если состояние беспроводной сети плохое, то число повторных передач будет расти, заставляя увеличиваться очередь пакетов. Блок формирования реагирует на заполненность очереди, отбрасывая пакеты до прибытия их к агенту.

ПА позволяет выполнять множество функций для улучшения качества предоставления мультимедийных услуг:
\begin{itemize}
\item ПА предоставляет дополнительную обратную связь для контент сервера с границы между проводной  и беспроводной частью сети \cite{SAdouble_feedback}.
\item ПА дает возможность определить место пакетной ошибки \cite{SAdouble_feedback}, что позваляет корректно реагировать на потери и задержки в сети.
\item Предварительное отбрасывание пакетов, которые передаются сверх возможностей беспроводной сети.
\item Ретрансляция на прикладном уровне позволяет уменьшить  пакетные искажения  для приложений не восприимчивых к задержке \cite{SArateOpt, SArealtime}.
\item Прямая коррекция ошибок позволяет уменьшить битовые искажения для приложений восприимчивых к задержке \cite{SArateOpt, SArealtime}.
\end{itemize}

Использование ПА, как платформу для внедрения буфера компенсации джиттера позволяет выполнять предварительную компенсацию джиттера в сети и тем самым упростить задачу буфера воспроизведения  на конечном устройстве.




\section{Выводы ко \ref{chapt3} разделу} \label{sect:concl3}

\begin{enumerate}
 \item Проведен анализ алгоритмов фильтрации для оценки текущего состояния случайного процесса с выбросами и скачками. Выбран алгоритм фильтрации, обладающий рядом необходимых свойств, которые позволяют на его основе реализовать алгоритм буфера компенсации джиттера. Проведен анализ работы выбранного алгоритма с рядом задержек, которые были сгенерированы с помощью математической модели процесса задержки (\ref{eq3:v} и (\ref{eq3:s}). Отметим (табл. \ref{fkDiffSit}), что выбранный алгоритм фильтрации превосходит остальные в условиях с выбросами и скачками.
 \item Разработан инвариантный алгоритм буфера компенсации джиттера, который позволяет решить ряд проблем возникающих, когда процесс пакетной задержки отклоняется от нормального распределения и имеет выбросы и скачки. Сравнительный анализ работы предложенного алгоритма с реальными задержками, которые были получены при анализе основных источников джиттера в проводных и беспроводных сетях в разделе \ref{chapt2} проведем в разделе \ref{chapt4}.
 \item Использование потоковых агентов позволяет решить проблему внедрения предложенного буфера компенсации джиттера в сеть LTE, избегая при этом дополнительных затрат так, как его внедрение можно реализовать простым обновлением программного обеспечения на SGW/PGW узле. Также ПА на данный момент уже имет целый ряд полезных функций, которые решают множество проблем на границе разделения сред для потокового трафика.
 \end{enumerate}



